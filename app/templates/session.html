{% extends "base.html" %}
{% block content %}
<div class="card" style="margin-bottom:16px;">
    <div class="page-head">
        <div>
            <h2 class="page-title">Live Session</h2>
            <p class="page-sub">Use Start/Stop in the navbar.</p>
        </div>
        <div class="page-badge">Local â€¢ Private</div>
    </div>

    <div id="liveFeedWrap" class="section" style="display:none;">
        <img id="liveFeed" src="" style="width:100%;border-radius:12px;border:1px solid var(--border);" alt="Live feed">
    </div>

    <div id="livePlaceholder" class="subtle" style="margin-top:10px;">
        Session is inactive. Start a session to view live feed.
    </div>
</div>

<div class="card">
    <div class="page-head">
        <div>
            <h2 class="page-title">Dashboard</h2>
            <p class="page-sub">Key system stats at a glance.</p>
        </div>
        <div class="page-badge">Realtime</div>
    </div>

    <div class="section" style="display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));">
        <div class="card" style="box-shadow:none;">
            <div class="subtle">Students</div>
            <div id="dStudents" style="font-size:28px;font-weight:800;">{{ total_students }}</div>
        </div>
        <div class="card" style="box-shadow:none;">
            <div class="subtle">Attendance Records</div>
            <div id="dRecords" style="font-size:28px;font-weight:800;">{{ total_records }}</div>
        </div>
        <div class="card" style="box-shadow:none;">
            <div class="subtle">FPS</div>
            <div id="dFps" style="font-size:28px;font-weight:800;">{{ fps }}</div>
        </div>
        <div class="card" style="box-shadow:none;">
            <div class="subtle">Detections</div>
            <div id="dDetections" style="font-size:28px;font-weight:800;">{{ detections }}</div>
        </div>
    </div>

    <div class="subtle" style="margin-top:10px;">Total Frames: <span id="dFrames">{{ frames }}</span></div>
</div>

<script>
    async function refreshDashboardMetrics() {
        try {
            const r = await fetch("/metrics/json");
            const d = await r.json();
            document.getElementById("dFps").textContent = d.fps;
            document.getElementById("dFrames").textContent = d.frames;
            document.getElementById("dDetections").textContent = d.detections;
        } catch { }
    }
    refreshDashboardMetrics();
    setInterval(refreshDashboardMetrics, 2000);
</script>
{% endblock %}

<button onclick="fetch('/session/start',{method:'POST'})">
    Start Session
</button>

<button onclick="fetch('/session/stop',{method:'POST'})">
    Stop Session
</button>